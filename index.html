<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>homework15</title>
</head>

<body>
    <script>
        const films = [
            {
                name: 'Back to the future',
                year: 1985,
                category: ['fantasy', 'comedy']
            },
            {
                name: 'The green mile',
                year: 1999,
                category: ['drama']
            },
            {
                name: 'Titanic',
                year: 1991,
                category: ['drama']
            },
            {
                name: 'The Lord of the Rings',
                year: 2001,
                category: ['fantasy']
            },
            {
                name: 'Star Wars',
                year: 1977,
                category: ['fantasy', 'comedy']
            },
        ];

        function createMapByCategory(films) {
            this.filmMap = films.reduce((filmsMap, film) => {
                const byCategory = film['category'];

                byCategory.forEach((category) => {
                        if (!filmsMap[category]) {
                            filmsMap[category] = [];
                        }
                        filmsMap[category].push(film);
                    });
                    
                    return filmsMap;
                }, {});

            this.filmMap[Symbol.iterator] = function() {
                const values = Object.values(this).flat();
                let valueIndex = 0;

                const checkValue = values.reduce((filmsMap, film) => {
                    if ( !filmsMap.includes(film)) {
                        filmsMap.push(film);
                    }

                    return filmsMap;
                }, []);

                return {
                    next() {
                        if (valueIndex === checkValue.length) {
                            return {done: true };
                        }

                        return {
                            done: false,
                            value: checkValue[valueIndex++]
                        }
                    }
                }
            };

            return this.filmMap;
        }

        const filmMap = new createMapByCategory(films);

        for (const film of filmMap) {
            console.log('Film: ', film);
        }

        console.log('Categories: ', filmMap);
    </script>
</body>
</html>